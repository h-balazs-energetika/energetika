<!DOCTYPE html>
<html lang="hu" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gázenergia Ajánlat-elemző - Nagyatád Város Önkormányzata</title>
    <!-- Font and Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Outfit:wght@700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-main: #0a0c10;
            --bg-card: #151921;
            --primary: #5c6bc0;
            --secondary: #26a69a;
            --accent: #7b61ff;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --border-color: #2d3748;
            --danger: #ef5350;
            --warning: #ffb74d;
            --success: #4caf50;
        }

        [data-theme="dark"] {
            color-scheme: dark;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6;
            padding-bottom: 4rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, #1a237e 0%, #0a0c10 100%);
            padding: 3rem 2rem;
            border-radius: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        header::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(123, 97, 255, 0.15) 0%, transparent 70%);
            z-index: 1;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        header h1 {
            font-family: 'Outfit';
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        header .subtitle {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 1.1rem;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
        }

        @media (max-width: 1100px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 1.25rem;
            padding: 1.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .card-title {
            font-family: 'Outfit';
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--primary);
        }

        /* Inputs */
        .input-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="number"],
        input[type="range"] {
            width: 100%;
            background: #0f1218;
            border: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            color: white;
            font-size: 1rem;
            font-weight: 600;
        }

        input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(123, 97, 255, 0.2);
        }

        .slider-wrap {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .slider-wrap span {
            min-width: 60px;
            font-weight: 800;
            color: var(--accent);
        }

        /* Comparison Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.03);
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 900;
            display: block;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        /* Summary Bar */
        .summary-banner {
            grid-column: 1 / -1;
            padding: 1.5rem;
            border-radius: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            font-weight: 800;
        }

        .winner-fix {
            background: rgba(38, 166, 154, 0.1);
            border: 1px solid var(--secondary);
            color: var(--secondary);
        }

        .winner-indexed {
            background: rgba(123, 97, 255, 0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th,
        td {
            padding: 0.75rem;
            text-align: left;
            font-size: 0.85rem;
            border-bottom: 1px solid #1e2530;
        }

        th {
            color: var(--text-muted);
            font-weight: 700;
            text-transform: uppercase;
        }

        .highlight-row {
            background: rgba(92, 107, 192, 0.05);
        }

        /* Analysis Sections */
        .alert-box {
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .alert-warning {
            background: rgba(255, 183, 77, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .alert-danger {
            background: rgba(239, 83, 80, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .alert-success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .chart-container {
            height: 350px;
            position: relative;
            margin-top: 1rem;
        }

        /* Risk List */
        .risk-list {
            list-style: none;
            margin-top: 1rem;
        }

        .risk-item {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .risk-item i {
            margin-top: 0.25rem;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <div class="header-content">
                <h1>Gázenergia Ajánlat-elemző</h1>
                <p class="subtitle">Nagyatád Város Önkormányzata • Irodai Döntéstámogató Rendszer</p>
            </div>
        </header>

        <div class="dashboard-grid">
            <!-- Control Side -->
            <div class="control-panel">
                <div class="card">
                    <h3 class="card-title text-primary"><i class="fas fa-sliders-h"></i> Paraméterek</h3>

                    <div class="input-group">
                        <label>Éves fogyasztás (kWh)</label>
                        <input type="number" id="annualKWh" value="400000" min="0" oninput="calculate()">
                        <div style="font-size:0.7rem; color:var(--text-muted); margin-top:4px;">kB. <span
                                id="m3Equivalent">0</span> m3 (1 m3 ≈ 10.5 kWh)</div>
                    </div>

                    <div class="input-group">
                        <label>Fix díjas alapár (Ft/kWh)</label>
                        <input type="number" id="fixPrice" value="23.5" step="0.1" oninput="calculate()">
                        <div style="font-size:0.7rem; color:var(--text-muted); margin-top:4px;">Jelenlegi érvényes
                            szerződés</div>
                    </div>

                    <div class="input-group">
                        <label>Kereskedői árrés (EUR/MWh)</label>
                        <input type="number" id="traderMargin" value="20.0" step="0.5" oninput="calculate()">
                        <div style="font-size:0.7rem; color:var(--text-muted); margin-top:4px;">Az indexált ajánlat
                            felára</div>
                    </div>

                    <div class="input-group">
                        <label>EUR/HUF Árfolyam</label>
                        <div class="slider-wrap">
                            <input type="range" id="eurRateRange" min="300" max="500" value="390"
                                oninput="document.getElementById('eurRateVal').innerText = this.value; calculate()">
                            <span id="eurRateVal">390</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Piaci várakozás (Tőzsdei ár +/- %)</label>
                        <div class="slider-wrap">
                            <input type="range" id="marketShift" min="-30" max="50" value="0"
                                oninput="document.getElementById('marketShiftVal').innerText = (this.value > 0 ? '+' : '') + this.value + '%'; calculate()">
                            <span id="marketShiftVal">0%</span>
                        </div>
                        <div style="font-size:0.65rem; color:var(--text-muted); margin-top:4px;">Kockázati szimuláció a
                            2025-ös bázishoz képest</div>
                    </div>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <h3 class="card-title" style="color:var(--accent);"><i class="fas fa-microchip"></i> Gyorsadatok
                    </h3>
                    <div class="stats-grid">
                        <div class="stat-box">
                            <span class="stat-label">Fix Költség</span>
                            <span class="stat-value" id="totalFixPrice">0</span>
                            <span class="stat-label">ezer Ft / év</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-label">Indexált Várható</span>
                            <span class="stat-value" id="totalIndexedPrice">0</span>
                            <span class="stat-label">ezer Ft / év</span>
                        </div>
                    </div>
                    <div id="savingsResult" class="summary-banner winner-indexed" style="display: none;">
                        <span>Várható megtakarítás:</span>
                        <span id="savingsValue">0 Ft</span>
                    </div>
                </div>
            </div>

            <!-- Main Display Side -->
            <div class="main-panel">
                <div class="card mb-4">
                    <h3 class="card-title"><i class="fas fa-chart-line"></i> Költség-vetület (Havi Ft/kWh)</h3>
                    <div class="chart-container">
                        <canvas id="compChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title"><i class="fas fa-clipboard-check"></i> Részletes Havi Elemzés</h3>
                    <div style="overflow-x: auto;">
                        <table id="detailsTable">
                            <thead>
                                <tr>
                                    <th>Hónap</th>
                                    <th>HUDEX (EUR)</th>
                                    <th>Fix ár</th>
                                    <th>Indexált ár</th>
                                    <th>Különbözet</th>
                                    <th>Státusz</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <h3 class="card-title" style="color:var(--warning);"><i class="fas fa-shield-alt"></i> Szakmai
                        Kiértékelés & Kockázatok</h3>
                    <div id="riskAnalysis">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 2025 HUDEX Baseline EUR/MWh
        const hudex2025 = [32, 33.5, 31, 29.5, 30.2, 32.8, 34.1, 35.5, 34.8, 36.2, 38.5, 39.1];
        const months = ['Jan', 'Feb', 'Már', 'Ápr', 'Máj', 'Jún', 'Júl', 'Aug', 'Szept', 'Okt', 'Nov', 'Dec'];

        let chartObj = null;

        function formatNumber(num) {
            return new Intl.NumberFormat('hu-HU').format(Math.round(num));
        }

        function calculate() {
            const annualKWh = parseFloat(document.getElementById('annualKWh').value) || 0;
            const fixPriceKWh = parseFloat(document.getElementById('fixPrice').value) || 0;
            const marginEUR = parseFloat(document.getElementById('traderMargin').value) || 0;
            const eurRate = parseFloat(document.getElementById('eurRateRange').value);
            const shiftFactor = 1 + (parseFloat(document.getElementById('marketShift').value) / 100);

            // Standard conversion
            document.getElementById('m3Equivalent').innerText = formatNumber(annualKWh / 10.5);

            const totalKWh = annualKWh;
            const monthlyKWh = totalKWh / 12;

            let totalFixCost = totalKWh * fixPriceKWh;
            let totalIndexedCost = 0;

            const indexedRates = [];
            const tableBody = document.querySelector('#detailsTable tbody');
            tableBody.innerHTML = '';

            hudex2025.forEach((baseEUR, i) => {
                const adjustedBase = baseEUR * shiftFactor;
                const indexedRateKWh = ((adjustedBase + marginEUR) * eurRate) / 1000;
                const monthlyCost = monthlyKWh * indexedRateKWh;
                totalIndexedCost += monthlyCost;

                indexedRates.push(indexedRateKWh.toFixed(2));

                const diff = fixPriceKWh - indexedRateKWh;
                const statusIcon = diff > 0 ? '<i class="fas fa-check-circle text-success"></i>' : '<i class="fas fa-exclamation-triangle text-danger"></i>';
                const diffClass = diff > 0 ? 'text-success' : 'text-danger';

                const row = tableBody.insertRow();
                row.innerHTML = `
                <td>${months[i]}</td>
                <td>${adjustedBase.toFixed(1)}</td>
                <td style="font-weight:600;">${fixPriceKWh}</td>
                <td style="font-weight:700; color:var(--accent);">${indexedRateKWh.toFixed(2)}</td>
                <td class="${diffClass}" style="font-weight:bold;">${(Math.abs(diff)).toFixed(2)}</td>
                <td style="text-align:center;">${statusIcon}</td>
            `;
            });

            // Update Stats
            document.getElementById('totalFixPrice').innerText = formatNumber(totalFixCost / 1000);
            document.getElementById('totalIndexedPrice').innerText = formatNumber(totalIndexedCost / 1000);

            const savings = totalFixCost - totalIndexedCost;
            const savingsEl = document.getElementById('savingsResult');
            const savingsVal = document.getElementById('savingsValue');

            savingsEl.style.display = 'flex';
            if (savings > 0) {
                savingsEl.className = 'summary-banner winner-indexed';
                savingsVal.innerText = formatNumber(savings) + " Ft megtakarítás";
            } else {
                savingsEl.className = 'summary-banner alert-danger';
                savingsVal.innerText = formatNumber(Math.abs(savings)) + " Ft veszteség";
            }

            updateRiskAnalysis(savings, fixPriceKWh, indexedRates, eurRate);
            updateChart(indexedRates, fixPriceKWh);
        }

        function updateRiskAnalysis(savings, fixPriceKWh, indexedRates, eurRate) {
            const riskEl = document.getElementById('riskAnalysis');
            let html = '';

            const maxIndexed = Math.max(...indexedRates);
            const avgIndexed = indexedRates.reduce((a, b) => parseFloat(a) + parseFloat(b), 0) / 12;

            // Proposal
            if (savings > 0) {
                html += `
                <div class="alert-box alert-success">
                    <i class="fas fa-check-double fa-2x"></i>
                    <div>
                        <strong>Javaslat: Átállás Indexáltra ajánlott.</strong> 
                        A modell alapján az éves megtakarítás eléri a <strong>${formatNumber(savings)} Ft</strong>-ot. 
                        Az átlagos egységár (${avgIndexed.toFixed(2)} Ft/kWh) 10-15%-kal a jelenlegi fix ár alatt marad.
                    </div>
                </div>
            `;
            } else {
                html += `
                <div class="alert-box alert-danger">
                    <i class="fas fa-hand-paper fa-2x"></i>
                    <div>
                        <strong>Javaslat: Maradás a FIX díjas szerződésben.</strong> 
                        A jelenlegi piaci viszonyok és az árrés mellett az indexált ár átlagosan ${Math.abs(avgIndexed - fixPriceKWh).toFixed(2)} Ft-tal magasabb a fix díjnál.
                    </div>
                </div>
            `;
            }

            // Risk factors
            html += '<p style="margin-top:1.5rem; font-weight:700; color:var(--text-main);"><i class="fas fa-exclamation-triangle text-warning"></i> Kritikus kockázati tényezők:</p>';
            html += '<ul class="risk-list">';

            html += `<li class="risk-item"><i class="fas fa-money-bill-wave text-warning"></i> <span><strong>Valutakockázat:</strong> Az EUR/HUF árfolyam minden 5 Ft-os romlása kB. 0.5 Ft-tal drágítja az indexált energiát (${eurRate} Ft-os bázison).</span></li>`;

            if (maxIndexed > fixPriceKWh) {
                html += `<li class="risk-item"><i class="fas fa-chart-line text-danger"></i> <span><strong>Szezonalitás:</strong> A téli hónapokban a tőzsdei ár elérheti a ${maxIndexed} Ft/kWh szintet, ami már a jelenlegi fix ár felett van.</span></li>`;
            }

            html += `<li class="risk-item"><i class="fas fa-globe-europe text-primary"></i> <span><strong>Geopolitika:</strong> Az indexált ár azonnal leköveti a gázpiaci sokkokat, míg a fix ár pufferként szolgál.</span></li>`;
            html += `<li class="risk-item"><i class="fas fa-file-contract text-accent"></i> <span><strong>Árrés rögzítés:</strong> A 20 EUR/MWh fix elem, de a tőzsdei változékonyság miatt a teljes ár forintban havonta 10-15%-ot is mozoghat.</span></li>`;
            html += `<li class="risk-item"><i class="fas fa-balance-scale text-secondary"></i> <span><strong>Likviditás:</strong> Az indexált számlázás változó havi költségei nehezítik az önkormányzati cash-flow tervezést a téli időszakban.</span></li>`;

            html += '</ul>';

            riskEl.innerHTML = html;
        }

        function updateChart(indexedData, fixValue) {
            const ctx = document.getElementById('compChart').getContext('2d');
            const fixData = Array(12).fill(fixValue);

            if (chartObj) {
                chartObj.data.datasets[0].data = indexedData;
                chartObj.data.datasets[1].data = fixData;
                chartObj.update();
            } else {
                chartObj = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Indexált ár (Ft/kWh)',
                                data: indexedData,
                                borderColor: '#7b61ff',
                                backgroundColor: 'rgba(123, 97, 255, 0.1)',
                                fill: true,
                                tension: 0.4,
                                borderWidth: 3
                            },
                            {
                                label: 'Fix ár (Ft/kWh)',
                                data: fixData,
                                borderColor: '#ffffff',
                                borderDash: [5, 5],
                                fill: false,
                                tension: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#94a3b8', font: { weight: 'bold' } } }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: { color: 'rgba(255,255,255,0.05)' },
                                ticks: { color: '#94a3b8' }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#94a3b8' }
                            }
                        }
                    }
                });
            }
        }

        // Initial run
        calculate();
    </script>

</body>

</html>